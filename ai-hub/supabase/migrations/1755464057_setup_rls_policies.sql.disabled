-- Migration: setup_rls_policies
-- Created at: 1755464057

-- Enable Row Level Security (RLS)
ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
ALTER TABLE knowledge_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE newsletters ENABLE ROW LEVEL SECURITY;
ALTER TABLE prompt_library ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_analytics ENABLE ROW LEVEL SECURITY;

-- RLS policies for projects
DROP POLICY IF EXISTS "project_access_policy" ON projects;
CREATE POLICY "project_access_policy" ON projects
  FOR ALL USING ((select auth.uid()) = user_id)
  WITH CHECK ((select auth.uid()) = user_id);

-- RLS policies for knowledge items
DROP POLICY IF EXISTS "knowledge_access_policy" ON knowledge_items;
CREATE POLICY "knowledge_access_policy" ON knowledge_items
  FOR ALL USING ((select auth.uid()) = user_id)
  WITH CHECK ((select auth.uid()) = user_id);

-- RLS policies for newsletters
DROP POLICY IF EXISTS "newsletter_access_policy" ON newsletters;
CREATE POLICY "newsletter_access_policy" ON newsletters
  FOR ALL USING ((select auth.uid()) = user_id)
  WITH CHECK ((select auth.uid()) = user_id);

-- RLS policies for prompt library - SELECT can access public prompts
DROP POLICY IF EXISTS "prompt_select_policy" ON prompt_library;
CREATE POLICY "prompt_select_policy" ON prompt_library
  FOR SELECT USING ((select auth.uid()) = user_id OR is_public = TRUE);

DROP POLICY IF EXISTS "prompt_modify_policy" ON prompt_library;
CREATE POLICY "prompt_modify_policy" ON prompt_library
  FOR INSERT WITH CHECK ((select auth.uid()) = user_id);

DROP POLICY IF EXISTS "prompt_update_policy" ON prompt_library;
CREATE POLICY "prompt_update_policy" ON prompt_library
  FOR UPDATE USING ((select auth.uid()) = user_id)
  WITH CHECK ((select auth.uid()) = user_id);

DROP POLICY IF EXISTS "prompt_delete_policy" ON prompt_library;
CREATE POLICY "prompt_delete_policy" ON prompt_library
  FOR DELETE USING ((select auth.uid()) = user_id);

-- RLS policies for user analytics
DROP POLICY IF EXISTS "analytics_access_policy" ON user_analytics;
CREATE POLICY "analytics_access_policy" ON user_analytics
  FOR ALL USING ((select auth.uid()) = user_id)
  WITH CHECK ((select auth.uid()) = user_id);;